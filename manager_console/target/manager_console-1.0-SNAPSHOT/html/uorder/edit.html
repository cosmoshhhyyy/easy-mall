<html lang="">
<head>
    <meta charset="utf-8">
    <title>layui</title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link rel="stylesheet" href="../../sources/layui/css/layui.css" media="all">
    <style>
        body {
            background-color: #ffffff;
        }
    </style>
</head>
<body>

<div class="layui-form layuimini-form" id="aaa">
    <div class="layui-form-item">
        <label class="layui-form-label required">ID</label>
        <div class="layui-input-block">
            <input type="text" name="oid" id="oid" value="" class="layui-input" readonly>
        </div>
    </div>
    <div class="layui-form-item">
        <label class="layui-form-label required">商品名称</label>
        <div class="layui-input-block">
            <select name="c_id" id="c_id" lay-verify="required" lay-reqtext="商品不能为空">
                <option value="">请选择商品</option>
            </select>
        </div>
    </div>
    <div class="layui-form-item">
        <label class="layui-form-label required">商家</label>
        <div class="layui-input-block">
            <select name="m_id" id="m_id" lay-verify="required" lay-reqtext="商家不能为空">
                <option value="">请选择商家</option>
            </select>
        </div>
    </div>
    <div class="layui-form-item">
        <label class="layui-form-label">购买用户</label>
        <div class="layui-input-block">
            <select name="u_id" id="u_id" lay-verify="required" lay-reqtext="购买用户不能为空">
                <option value="">请选择购买用户</option>
            </select>
        </div>
    </div>
    <div class="layui-form-item">
        <label class="layui-form-label">购买数量</label>
        <div class="layui-input-block">
            <input type="text" name="num" id="num" lay-verify="required" lay-reqtext="购买数量不能为空"
                   placeholder="请输入购买数量" value="" class="layui-input">
        </div>
    </div>
    <div class="layui-form-item">
        <label class="layui-form-label">下单日期</label>
        <div class="layui-input-inline">
            <input type="text" class="layui-input" id="ID-laydate-demo" placeholder="yyyy-MM-dd">
        </div>
    </div>
    <div class="layui-form-item">
        <label class="layui-form-label">订单状态</label>
        <div class="layui-input-block">
            <select name="statu" lay-verify="required" lay-reqtext="订单状态不能为空">
                <option value="0">处理中</option>
                <option value="1">已发货</option>
                <option value="2">已完成</option>
            </select>
        </div>
    </div>
    <div class="layui-form-item">
        <div class="layui-input-block">
            <button class="layui-btn layui-btn-normal" lay-submit lay-filter="saveBtn">确认修改</button>
        </div>
    </div>
</div>
<script src="../../sources/layui/layui.js" charset="utf-8"></script>
<script>
    layui.use('laydate', function () {
        const laydate = layui.laydate;

        //执行一个laydate实例
        laydate.render({
            elem: '#ID-laydate-demo' //指定元素
        });
    });

    layui.use(['form'], function () {
        const form = layui.form,
            $ = layui.$;

        //获取所有商品
        $.ajax({
            url: '/uorder/findAllCommodity',
            type: 'get',
            dataType: 'json',
            success: function (data) {
                // 将获取到的数据json数组添加到select标签中
                for (let i = 0; i < data.length; i++) {
                    $('#c_id').append("<option value='" + data[i].cid + "'>" + data[i].pname + "</option>");
                    // 刷新select选择框渲染
                    form.render('select');
                }
            },
            error: function (XMLHttpRequest, textStatus, errorThrown) {
                alert(typeof (errorThrown));
            }
        });

        //获取所有商家
        $.ajax({
            url: '/uorder/findAllSeller',
            type: 'get',
            dataType: 'json',
            success: function (data) {
                // 将获取到的数据json数组添加到select标签中
                for (let i = 0; i < data.length; i++) {
                    $('#t_id').append("<option value='" + data[i].uid + "'>" + data[i].username + "</option>");
                    // 刷新select选择框渲染
                    form.render('select');
                }
            },
            error: function (XMLHttpRequest, textStatus, errorThrown) {
                alert(typeof (errorThrown));
            }
        });

        //获取所有用户
        $.ajax({
            url: '/uorder/findAllUser',
            type: 'get',
            dataType: 'json',
            success: function (data) {
                // 将获取到的数据json数组添加到select标签中
                for (let i = 0; i < data.length; i++) {
                    $('#u_id').append("<option value='" + data[i].uid + "'>" + data[i].username + "</option>");
                    // 刷新select选择框渲染
                    form.render('select');
                }
            },
            error: function (XMLHttpRequest, textStatus, errorThrown) {
                alert(typeof (errorThrown));
            }
        });

        // $.ajax({
        //     url: '/uorder/selectByPrimaryKey',
        //     type: 'get',
        //     data: {"oid": $("#oid").val()},
        //     dataType: 'json',
        //     success: function (data) {
        //         //给子页面id=aaa的dev里的不同ID值的元素赋值
        //         $("#oid").val(data.oid);
        //         $("#c_id").val(data.c_id);
        //         $("#m_id").val(data.m_id);
        //         $("#u_id").val(data.u_id);
        //         $("#num").val(data.num);
        //         $("#oderDate").val(data.oderDate);
        //         $("#statu").val(data.statu);
        //     },
        //     error: function (XMLHttpRequest, textStatus, errorThrown) {
        //         alert(typeof (errorThrown));
        //     }
        // });

        //监听提交
        form.on('submit(saveBtn)', function (data) {
            $.ajax({
                url: '/uorder/updateByPrimaryKey',
                type: 'post',
                data: {
                    oid: data.field.oid,
                    c_id: data.field.c_id,
                    m_id: data.field.m_id,
                    u_id: data.field.u_id,
                    num: data.field.num,
                    oderDate: data.field.oderDate,
                    statu: data.field.statu
                },
                success: function (data) {
                    if (data === 200) {
                        alert("修改成功");
                    } else {
                        alert("修改失败");
                    }
                },
                error: function (XMLHttpRequest, textStatus, errorThrown) {
                    alert(typeof (errorThrown));
                }
            });
            const iframeIndex = parent.layer.getFrameIndex(window.name);
            parent.layer.close(iframeIndex);
            return false;
        });
    });

</script>
</body>
</html>
